<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nifty 50 Stock Recommendations</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        table {
            border-collapse: collapse;
            width: 80%;
            margin: 20px auto;
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }

        th {
            background-color: #f2f2f2;
        }

        .signal-BUY {
            color: green;
            font-weight: bold;
        }

        .signal-SELL {
            color: red;
            font-weight: bold;
        }

        .signal-HOLD {
            color: orange;
            font-weight: bold;
        }
    </style>
</head>

<body>

<h1>Nifty 50 Stock Recommendations</h1>
<p>Data Refreshed on: <span id="refreshedDate">Loading...</span></p>
<table>
    <thead>
        <tr>
            <th>Stock Name</th>
            <th>Latest Close Price</th>
            <th>Signal</th>
        </tr>
    </thead>
    <tbody id="stockTable">
        <tr>
            <td colspan="3">Loading...</td>
        </tr>
    </tbody>
</table>

<script>
    const GITHUB_USER = "sohamdeshpande";
    const REPO_NAME = "dashboard";
    const STOCKS = [
    ['ADANIENT.NS',
 'ADANIPORTS.NS',
 'APOLLOHOSP.NS',
 'ASIANPAINT.NS',
 'AXISBANK.NS',
 'BAJAJ-AUTO.NS',
 'BAJFINANCE.NS',
 'BAJAJFINSV.NS',
 'BEL.NS',
 'BPCL.NS',
 'BHARTIARTL.NS',
 'BRITANNIA.NS',
 'CIPLA.NS',
 'COALINDIA.NS',
 'DRREDDY.NS',
 'EICHERMOT.NS',
 'GRASIM.NS',
 'HCLTECH.NS',
 'HDFCBANK.NS',
 'HDFCLIFE.NS',
 'HEROMOTOCO.NS',
 'HINDALCO.NS',
 'HINDUNILVR.NS',
 'ICICIBANK.NS',
 'ITC.NS',
 'INDUSINDBK.NS',
 'INFY.NS',
 'JSWSTEEL.NS',
 'KOTAKBANK.NS',
 'LT.NS',
 'M&M.NS',
 'MARUTI.NS',
 'NTPC.NS',
 'NESTLEIND.NS',
 'ONGC.NS',
 'POWERGRID.NS',
 'RELIANCE.NS',
 'SBILIFE.NS',
 'SHRIRAMFIN.NS',
 'SBIN.NS',
 'SUNPHARMA.NS',
 'TCS.NS',
 'TATACONSUM.NS',
 'TATAMOTORS.NS',
 'TATASTEEL.NS',
 'TECHM.NS',
 'TITAN.NS',
 'TRENT.NS',
 'ULTRACEMCO.NS',
 'WIPRO.NS']
        // Add all 50 stock names here...
    ];

    async function fetchCSV(stock) {
        const CSV_PATH = `data/${stock}.csv`;
        const RAW_GITHUB_URL = `https://raw.githubusercontent.com/${GITHUB_USER}/${REPO_NAME}/main/${CSV_PATH}`;
        try {
            const response = await fetch(RAW_GITHUB_URL);
            if (!response.ok) throw new Error(`Failed to fetch CSV for ${stock}`);
            const csvContent = await response.text();
            return csvContent;
        } catch (error) {
            console.error("Error fetching CSV:", error);
            return null;
        }
    }

    function parseCSV(csvContent, stockName) {
        const rows = csvContent.trim().split("\n");
        const headers = rows[0].split(",");
        const lastRow = rows[rows.length - 1].split(",");

        const closePrice = lastRow[headers.indexOf("Close")];
        const signal = lastRow[headers.indexOf("Signal")];
        const lastDate = lastRow[0];

        return { stockName, closePrice, signal, lastDate };
    }

    function renderTable(stockData) {
        const tableBody = document.getElementById("stockTable");
        tableBody.innerHTML = "";  // Clear existing rows

        stockData.forEach(data => {
            const { stockName, closePrice, signal, lastDate } = data;
            const row = `
                <tr>
                    <td>${stockName}</td>
                    <td>${parseFloat(closePrice).toFixed(2)}</td>
                    <td class="signal-${signal}">${signal}</td>
                </tr>
            `;
            tableBody.innerHTML += row;
        });

        document.getElementById("refreshedDate").textContent = stockData[0]?.lastDate || "Unknown";
    }

    async function initDashboard() {
        const stockData = [];

        for (const stock of STOCKS) {
            const csvContent = await fetchCSV(stock);
            if (csvContent) {
                const data = parseCSV(csvContent, stock);
                stockData.push(data);
            }
        }

        if (stockData.length > 0) {
            renderTable(stockData);
        } else {
            document.getElementById("stockTable").innerHTML = "<tr><td colspan='3'>Failed to load data.</td></tr>";
        }
    }

    initDashboard();
</script>

</body>
</html>
